language: node_js
node_js:
  - 12 # uses version 12
services:
  - postgresql # starts up postgres
addons:
  postgresql: '10' # recent postgres version on Travis
dist: xenial # uses xenial environment
notifications:
  email:
    on_success: change # default: change (only when going from broken to fixed)
    on_failure: always # default: always (which is annoying, as it should be)
install:
  - npm ci # faster, goes only from package-lock
before_script:
  - psql -c 'create database "grace-shopper-test";' -U postgres # remember to change this name if you change it elsewhere (e.g. package.json)
script:
  - npm test # test the code
  - npm run build-client # make the bundle
before_deploy: # omit node_modules, since we set skip_cleanup below
  - rm -rf node_modules
deploy: # see README for details on these keys
  # prevents travis from deleting the build
  skip_cleanup: true
  provider: heroku
  # the secure key indicates an encrypted value; see README
  api_key:
    secure: L2Yh5yyIGKj+lPS65rqe9CtxfRyUxQRzW3tuAqJvZsGPOOP97+QLRADS5vUgoKybCkl/WFfsAlGLZ7PybaVQ/2CaS1JM4vVa/Z3NBqEYJPUGSvSWzgcXlxaZlhzY7BZFcZf8VB6v3f4n/66mDcvYbp2uUgZqRdCrUgALR1btGOhkf2Mr2PH0R2Lf5TWt3hkBI2BUP4Y+1sQhoGwym2i0DgYhO0aXNVJstHZptHKfEa7qz2lfNDTkT5wcwRCZ+sKDQn42wH/qdbBMqrJfNkaZ50or9Z1CocXR+wqtVZ8RsWOlgsNR0y7DAkgubj8Y4QazBnvOpikBv5k47pOQR1yzQ+f2awk6kxdrr8LhwmJVoWOGDimBF1kduG8EXmxI5N/Ck3v4/D7/Rx5D2dJe7NNCicESts8Ee2YlWrWE10fpoSkR4XKhtrIH9vOB/SXethDi9kJT5ij97i7ZrIviG7mxhaip03WdoT+UWqFTwtCWwLwDPxhNnnHrPks8zJobxRVc3341+XqdL08RZ3zzZkolqIUmvFp0ZdReB95tgXD+YA/ynGlMAxbMqUA53feWNDJKfGB6IaL9S30kojNev3/QBljXJ2JAz8pGIwboWTJr9AHqQftL+0G6zIgRaKK3XZUQ136JfeWSTl4tSFL+eisdJHulbO1XTDj99bHhLTr6FKo=
  # app should be your heroku app name; see README
  app: ufo-tofu
  on: 
    branch: main
